pipeline {
    agent any

    parameters {
        choice(name: 'language', choices: ['node', 'python'], description: 'Select the programming language')
        string(name: 'name', defaultValue: 'Huy', description: 'Enter your name')
    }

      environment {
    GITHUB_TOKEN = credentialsId('Huygon764') // Jenkins will inject it
  }

    stages {
        stage('Initialize') {
            steps {
                echo "Initializing the pipeline for ${params.language} with name ${params.name}"
            }
        }

        stage('Create log') {
            steps {
                echo "Build successful at $(date)"
            }
        }

        stage('Run LocaleCash Tests') {
    steps {
        script {
            echo "ðŸ§ª Triggering LocaleCash testing workflow..."
            
            sh """
                curl -X POST \\
                    -H "Accept: application/vnd.github.v3+json" \\
                    -H "Authorization: token ${GITHUB_TOKEN}" \\
                    -H "Content-Type: application/json" \\
                    https://api.github.com/repos/Huygon764/localecash-local/actions/workflows/localecash-testing.yml/dispatches \\
                    -d '{"ref":"master"}'
            """
            
            echo "âœ… LocaleCash testing workflow triggered successfully"
        }
    }
}
    }

    post {
        always {
            echo "Build success"
            archiveArtifacts artifacts: '1.log.txt', fingerprint: true
        }
    }
}